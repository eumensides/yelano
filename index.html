// m3u8直播源数组
const videoSources = [
    { id: 'video1', url: 'http://play.zhihuiwenlvyun.com/live/shizifeng.m3u8' },
    { id: 'video2', url: 'http://play.zhihuiwenlvyun.com/live/chaoyinpu.m3u8' },
    { id: 'video3', url: 'http://play.zhihuiwenlvyun.com/live/taiqingwan.m3u8' },
    { id: 'video4', url: 'http://play.zhihuiwenlvyun.com/live/jufengxiazhan.m3u8' },
    { id: 'video5', url: 'http://play.zhihuiwenlvyun.com/live/shouzifeng.m3u8' },
    { id: 'video6', url: 'http://play.zhihuiwenlvyun.com/live/lingqifeng.m3u8' },
    { id: 'video7', url: 'http://play.zhihuiwenlvyun.com/live/erlongshan.m3u8' },
    { id: 'video8', url: 'http://play.zhihuiwenlvyun.com/live/shanhaishengjing.m3u8' },
    { id: 'video9', url: 'https://hlspull.qtv.com.cn/v31faxcg/channel/6cf6c074ce8070489151af48ad13ca71/1.m3u8' },
    { id: 'video10', url: 'https://hlspull.qtv.com.cn/v31faxcg/channel/dba5f5df47dc14a9b08385b1c22faadf/1.m3u8' },
    { id: 'video11', url: 'https://hlspull.qtv.com.cn/v31faxcg/channel/51d10523f0a1fdcda5c4223babe1682c/1.m3u8' },
    { id: 'video12', url: 'https://hlspull.qtv.com.cn/v31faxcg/channel/e41ccb39c3292d868d6c72b66082a3f2/1.m3u8' },
    { id: 'video13', url: 'https://hlspull.qtv.com.cn/v31faxcg/channel/833fddf8b8271df2cf38835d14a2a3a5/1.m3u8' },
    { id: 'video14', url: 'https://hlspull.qtv.com.cn/v31faxcg/channel/8db708403e7ad9c1a00c539c703b8ae0/1.m3u8' },
    { id: 'video15', url: 'https://hlspull.qtv.com.cn/v31faxcg/channel/eb43a644427fb8349dcee68178054782/1.m3u8' }
];

// 初始化每个视频播放器
videoSources.forEach(source => {
    const video = document.getElementById(source.id);
    
    if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(source.url);
        hls.attachMedia(video);
        hls.on(Hls.Events.ERROR, (event, data) => {
            if (data.fatal) {
                console.error(`Error loading ${source.url}: ${data.details}`);
            }
        });
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = source.url;
        video.addEventListener('error', () => {
            console.error(`Native HLS error for ${source.url}`);
        });
    }
});

// 获取青岛天气数据（QWeather API）
fetch('https://mv5n8k7max.re.qweatherapi.com/v7/weather/now?location=101120201&key=6c6631dbef6f4d2393574cc5d327178f')
    .then(response => response.json())
    .then(data => {
        if (data.code !== '200') {
            throw new Error(`QWeather API error: ${data.code}`);
        }

        const location = document.getElementById('location');
        const description = document.getElementById('weather-description');
        const weatherIcon = document.getElementById('weather-icon');
        const temperature = document.getElementById('temperature');
        const feelsLike = document.getElementById('feels-like');
        const tempMin = document.getElementById('temp-min');
        const tempMax = document.getElementById('temp-max');
        const pressure = document.getElementById('pressure');
        const humidity = document.getElementById('humidity');
        const visibility = document.getElementById('visibility');
        const wind = document.getElementById('wind');
        const windGust = document.getElementById('wind-gust');
        const clouds = document.getElementById('clouds');
        const sunrise = document.getElementById('sunrise');
        const sunset = document.getElementById('sunset');

        // QWeather doesn't provide min/max temp or sunrise/sunset in the "now" API, so these will be placeholders
        // You can fetch them from the QWeather 7-day forecast API if needed
        location.textContent = `地区：青岛, 中国`;
        description.textContent = `天气：${data.now.text}`;
        weatherIcon.innerHTML = `<img src="https://a.hecdn.net/img/weather/icon/v3/${data.now.icon}.png" class="weather-icon" alt="Weather Icon">`;
        temperature.textContent = `当前温度：${data.now.temp} °C`;
        feelsLike.textContent = `体感温度：${data.now.feelsLike} °C`;
        tempMin.textContent = `最低温度：无数据`;
        tempMax.textContent = `最高温度：无数据`;
        pressure.textContent = `气压：${data.now.pressure} hPa`;
        humidity.textContent = `湿度：${data.now.humidity}%`;
        visibility.textContent = `能见度：${data.now.vis} 公里`;
        wind.textContent = `风速：${data.now.windSpeed} km/h，方向：${data.now.windDir}`;
        windGust.textContent = `阵风：无数据`;
        clouds.textContent = `云量：${data.now.cloud || '0'}%`;
        sunrise.textContent = `日出：无数据`;
        sunset.textContent = `日落：无数据`;
    })
    .catch(error => {
        console.error('Error fetching weather data:', error);
        document.getElementById('location').textContent = '无法加载天气数据';
    });
